{
  "title": "SCP vShop_ingestion_{operation_date}",
  "properties": {
    "operation_date": "yyyyMMdd",
    "display_date": "dd MMMM yyyy"
  },
  "sections": [
    {
      "heading": "Operation Overview",
      "content": [
        {
          "type": "table",
          "style": "border-collapse: collapse; width: 100%; background: #fff; border: 1px solid #ddd; font-size: 15px;",
          "fields": [
            {
              "label": "Field",
              "id": "field_label",
              "style": "border: 1px solid #ddd; background: #f7f7f7; vertical-align: top; width: 30%; font-weight: bold;"
            },
            {
              "label": "Value",
              "id": "field_value",
              "style": "border: 1px solid #ddd; background: #fff; vertical-align: top; width: 70%;"
            },
            {
              "label": "Status",
              "id": "field_status",
              "style": "border: 1px solid #ddd; background: #fff; vertical-align: top; width: 70%;"
            }
          ],
          "static_values": {
            "ticket": "S-IN: TICKET_NUMBER - SCP Shop S-IN",
            "approvals_sre": "@Pawar, Nikhil, @Rawat, Megha",
            "approvals_sre_emails": {
              "@Pawar, Nikhil": "nikhil.pawar@example.com",
              "@Rawat, Megha": "megha.rawat@example.com"
            },
            "approvals_sre_status": "NOT APPROVED",
            "operation_pic": "@Ali, Abrar",
            "release_branch_checkboxes_status": "release/vSCP_shop_ingestion_20250602\n\nRC:\nhttps://gitpub.rakuten-it.com/projects/SCP/repos/scp-rsl-shops/browse?at=refs%2Fheads%2Frelease%2FvSCP_shop_ingestion_20250602\n\nPR:\nhttps://gitpub.rakuten-it.com/projects/SCP/repos/scp-rsl-shops/pull-requests/35/overview"
          },
          "rows": [
            {
              "label": "Operation Date and Time",
              "id": "display_date"
            },
            {
              "label": "Ticket",
              "id": "ticket"
            },
            {
              "label": "Approvals | SRE",
              "id": "approvals_sre"
            },
            {
              "label": "Operation PIC",
              "id": "operation_pic"
            },
            {
              "label": "Operation Details",
              "id": "operation_details"
            },
            {
              "label": "Operation Summary",
              "id": "operation_summary"
            },
            {
              "label": "Release/Hotfix branch created",
              "id": "release_branch_checkboxes",
              "checkboxes": [
                "DONE",
                "NOT YET",
                "NOT APPLICABLE"
              ]
            },
            {
              "label": "Release Branch",
              "id": "release_branch_name"
            }
          ]
        }
      ]
    },
    {
      "heading": "S-IN Preparation",
      "content": [
        {
          "type": "table",
          "style": "border-collapse: collapse; width: 100%; background: #fff; border: 1px solid #ddd; font-size: 15px;",
          "fields": [
            {
              "label": "Task",
              "id": "preparation_task",
              "style": "border: 1px solid #ddd; background: #f7f7f7; vertical-align: top; font-weight: bold;"
            },
            {
              "label": "Steps",
              "id": "preparation_steps",
              "style": "border: 1px solid #ddd; background: #f7f7f7; vertical-align: top; font-weight: bold;"
            },
            {
              "label": "Screenshots",
              "id": "preparation_screenshots",
              "style": "border: 1px solid #ddd; background: #f7f7f7; vertical-align: top; font-weight: bold;"
            }
          ],
          "static_values": {
            "verify_shop_exists": "{expand:title=Shop Verification Query}\n{code:language=sql|borderStyle=solid|theme=RDark|collapse=true}\nSELECT * FROM scp_shops WHERE SHOP_URL IN ('mogumogu','tennis.com','hsrp','spider','joker','santai','store','jewelry.com','handmade','kaneko','toyshop','blackmarket','muf-bo','h2o','art','calm')\n{code}",
            "check_main_warehouse_center_cd": "{expand:title=center id}\n{code:language=sql|borderStyle=solid|theme=RDark|collapse=true}\nSELECT SELLER_CD, CENTER_CD, MAIN_CENTER_FLG FROM RM_SELLER_CENTER WHERE MAIN_CENTER_FLG = 1 AND NOT DEL_FLG = 1 AND SELLER_CD IN ('42126','42270','42357','42315','42384','42393','42400','42229','42416','42455','42388','42444','42430','41186','36949','40027')\n{code}",
            "check_id_with_center_name": "{expand:title=center name}\n{code:language=sql|borderStyle=solid|theme=RDark|collapse=true}\nSELECT NAME_JP, ID FROM SCP_WAREHOUSES\n{code}",
            "center_codes_data": [
              {"code": "01", "name": "RFC市川I", "alias": "rfcichikawa1"},
              {"code": "03", "name": "RFC市川II", "alias": "rfcichikawa2"},
              {"code": "04", "name": "RFC市川III", "alias": "rfcichikawa3"},
              {"code": "05", "name": "RFC川西", "alias": ""},
              {"code": "06", "name": "RFC枚方", "alias": "rfchirakata"},
              {"code": "07", "name": "RFC流山", "alias": "rfcnagareyama"},
              {"code": "08", "name": "RFC習志野", "alias": "rfcnarashino"},
              {"code": "09", "name": "RFC中央林間", "alias": "rfcchuorinkan"},
              {"code": "11", "name": "RFC福岡", "alias": "rfcfukuoka"},
              {"code": "12", "name": "RFC八尾", "alias": "rfcyao"},
              {"code": "13", "name": "RFC茨木", "alias": "rfcIbaraki"},
              {"code": "14", "name": "RFC松戸", "alias": "rfcmatsudo"}
            ]
          },
          "rows": [
            {
              "label": "Verify Shop's exists or not in DB",
              "id": "verify_shop_exists"
            },
            {
              "label": "Check main warehouse's center_cd for each seller @川西DB - RSL_STUSER",
              "id": "check_main_warehouse_center_cd"
            },
            {
              "label": "Check ID with the center name @市川DB - SCG_PROD",
              "id": "check_id_with_center_name"
            },
            {
              "label": "Check center name for detected center code from the table",
              "id": "check_center_name_for_code"
            }
          ]
        }
      ]
    },
    {
      "heading": "S-IN Execution",
      "content": [
        {
          "type": "table",
          "style": "border-collapse: collapse; width: 100%; background: #fff; border: 1px solid #ddd; font-size: 15px;",
          "fields": [
            {
              "label": "Task",
              "id": "execution_task",
              "style": "border: 1px solid #ddd; background: #f7f7f7; vertical-align: top; font-weight: bold;"
            },
            {
              "label": "Steps",
              "id": "execution_steps",
              "style": "border: 1px solid #ddd; background: #f7f7f7; vertical-align: top; font-weight: bold;"
            },
            {
              "label": "Remarks",
              "id": "execution_remarks",
              "style": "border: 1px solid #ddd; background: #f7f7f7; vertical-align: top; font-weight: bold;"
            }
          ],
          "static_values": {
            "import_shop_warehouse_location_data": "Checkout 'release/vShop_ingestion_{operation_date}' the RC Branch\n\nGo to https://confluence.rakuten-it.com/confluence/display/SCG/%5BNEW+from+DCP%5D+Manual+to+Update+Reference+Data and follow [Shop warehouse location reference data] section",
            "verify_shop_warehouse_location_data": "select * from scp_shop_warehouse_location where shop_url in (select SHOP_URL from scp_shops where CREATE_TIMESTAMP > trunc(sysdate))",
            "update_shop_data": "Operation steps to do \"Shop Reference Data\" from https://confluence.rakuten-it.com/confluence/display/SCG/%5BNEW+from+DCP%5D+Manual+to+Update+Reference+Data"
          },
          "rows": [
            {
              "label": "Shop warehouse location reference data /n, Import SCP_SHOP_WAREHOUSE_LOCATION data",
              "id": "import_shop_warehouse_location_data"
            },
            {
              "label": "Verification of SCP_SHOP_WAREHOUSE_LOCATION data",
              "id": "verify_shop_warehouse_location_data"
            },
            {
              "label": "Update shop data",
              "id": "update_shop_data"
            }
          ]
        }
      ]
    },
    {
      "heading": "S-IN Verification",
      "content": [
        {
          "type": "table",
          "style": "border-collapse: collapse; width: 100%; background: #fff; border: 1px solid #ddd; font-size: 15px;",
          "fields": [
            {
              "label": "Task",
              "id": "verification_task",
              "style": "border: 1px solid #ddd; background: #f7f7f7; vertical-align: top; font-weight: bold;"
            },
            {
              "label": "Steps",
              "id": "verification_steps",
              "style": "border: 1px solid #ddd; background: #f7f7f7; vertical-align: top; font-weight: bold;"
            },
            {
              "label": "Remarks",
              "id": "verification_remarks",
              "style": "border: 1px solid #ddd; background: #f7f7f7; vertical-align: top; font-weight: bold;"
            }
          ],
          "static_values": {
            "verify_seller_code_warehouse_shop_url": "select e1.SHOP_ID , e1.SHOP_URL , e3.WAREHOUSE_ID , e7.SELLER_CD from SCP_SHOPS e1 INNER JOIN( select DISTINCT e2.SHOP_URL , e2.WAREHOUSE_ID from SCP_SHOP_WAREHOUSE_LOCATION e2 where SHOP_URL IN ('belkin-shop') GROUP BY SHOP_URL, WAREHOUSE_ID ) e3 ON e1.SHOP_URL= e3.SHOP_URL AND e1.RSL_SHOP_FLAG = '1' LEFT JOIN ( select DISTINCT e5.SHOP_URL, e5.SELLER_CD from SCP_SKU_DETAILS e5 INNER JOIN( select max(CHANGE_TIMESTAMP) LAST_CHANGE_TIMESTAMP, SHOP_URL from SCP_SKU_DETAILS where SHOP_URL IN ('belkin-shop') group by SHOP_URL ) e6 on e5.SHOP_URL = e6.SHOP_URL and e5.CHANGE_TIMESTAMP = e6.LAST_CHANGE_TIMESTAMP ) e7 ON e1.SHOP_URL=e7.SHOP_URL",
            "verify_items_published": "Check if Items belongs to shops are published\n\nCount of published items:\n\nselect e1.ITEM_STOCK_ID, e1.SHOP_URL, e1.RMS_ITEM_MANAGEMENT_NUMBER, e1.SHOP_ID, e1.ITEM_ID, e1.HCHOICE_NAME, e1.VCHOICE_NAME, e1.EVENT_TYPE, e1.EVENT_TIMESTAMP, e1.WAREHOUSE_ID, e1.SCP_SYNC_STATUS_V2 from scp_sku_detail_events e1 inner join( select max(EVENT_TIMESTAMP) LAST_EVENT_TIMESTAMP, ITEM_STOCK_ID from scp_sku_detail_events group by ITEM_STOCK_ID ) e2 on e1.ITEM_STOCK_ID = e2.ITEM_STOCK_ID and e1.EVENT_TIMESTAMP = e2.LAST_EVENT_TIMESTAMP where e1.SCP_SYNC_STATUS_V2 = '1' and e1.SHOP_URL in ('belkin-shop') and e1.EVENT_TYPE = 'PUT' and EVENT_TIMESTAMP >  trunc(sysdate) order by CHANGE_TIMESTAMP desc",
            "verify_sample_items_scp_calculation": "How to identify if SCP dates is showing?\n\nCheck for the \"RSL_V1_CALCULATION\" tag\n\nRight click > Inspect > Network\nClick the \"trashcan\" icon or \"no entry\" icon to clear the logs\nselect an SKU from the webpage then click \"shippingCalculation?apikey...\"\n\nIf \"shippingCalculation?apikey...\"  if found, skip this step and proceed to next step\n\nIf \"shippingCalculation?apikey...\" is not found, try...\n\nDisable cache or refresh the page\nNote: If \"shippingCalculation?apikey...\" does not appear it might mean that the webpage has been cached.\nGo to \"Response\" and check for \"RSL_V1_CALCULATION\" tag\n\nJust for reference:\nTAGS meaning\nRSL_V1_CALCULATION = SCP calculation\nRMS_V1_CALCULATION = RMS calculation (fallback logic)",
            "query_after_sin_zero_quantity": "select item_stock_id from scp_warehouse_inventories where item_stock_id in ( select e1.ITEM_STOCK_ID from scp_sku_detail_events e1 inner join( select max(EVENT_TIMESTAMP) LAST_EVENT_TIMESTAMP, ITEM_STOCK_ID from scp_sku_detail_events group by ITEM_STOCK_ID ) e2 on e1.ITEM_STOCK_ID = e2.ITEM_STOCK_ID and e1.EVENT_TIMESTAMP = e2.LAST_EVENT_TIMESTAMP where e1.SCP_SYNC_STATUS_V2 = '1' and e1.SHOP_URL in ('belkin-shop') and e1.EVENT_TYPE = 'PUT' and EVENT_TIMESTAMP > SYSDATE-1 and create_user='reference-data' ) and quantity=0 and center_code is not null group by item_stock_id having count(*)=2"
          },
          "rows": [
            {
              "label": "Verify the Seller Code, Warehouse, Shop URL and Shop Id",
              "id": "verify_seller_code_warehouse_shop_url"
            },
            {
              "label": "Verify items are published",
              "id": "verify_items_published"
            },
            {
              "label": "Verify sample items show SCP calculation",
              "id": "verify_sample_items_scp_calculation"
            },
            {
              "label": "Query after S-IN to find if any item with 0 quantity in RSL was published. It should be 'NO Matching Records'",
              "id": "query_after_sin_zero_quantity"
            }
          ]
        }
      ]
    },
    {
      "heading": "Rollback Plan",
      "content": [
        {
          "type": "table",
          "style": "border-collapse: collapse; width: 100%; background: #fff; border: 1px solid #ddd; font-size: 15px;",
          "fields": [
            {
              "label": "Step",
              "id": "rollback_step",
              "style": "border: 1px solid #ddd; background: #f7f7f7; vertical-align: top; font-weight: bold;"
            },
            {
              "label": "Details",
              "id": "rollback_details",
              "style": "border: 1px solid #ddd; background: #f7f7f7; vertical-align: top; font-weight: bold;"
            },
            {
              "label": "Remark",
              "id": "rollback_remark",
              "style": "border: 1px solid #ddd; background: #f7f7f7; vertical-align: top; font-weight: bold;"
            }
          ],
          "rows": [
            {
              "label": "Share details and impact with producer and manager",
              "id": "share_rollback_details"
            },
            {
              "label": "Deploy old image of the prometheus using previous release manual",
              "id": "deploy_old_prometheus"
            }
          ]
        }
      ]
    },
    {
      "heading": "Monitoring Plan",
      "content": [
        {
          "type": "table",
          "style": "border-collapse: collapse; width: 100%; background: #fff; border: 1px solid #ddd; font-size: 15px;",
          "fields": [
            {
              "label": "Task",
              "id": "monitoring_task",
              "style": "border: 1px solid #ddd; background: #f7f7f7; vertical-align: top; font-weight: bold;"
            },
            {
              "label": "Remark",
              "id": "monitoring_remark",
              "style": "border: 1px solid #ddd; background: #f7f7f7; vertical-align: top; font-weight: bold;"
            },
            {
              "label": "PIC",
              "id": "monitoring_pic",
              "style": "border: 1px solid #ddd; background: #f7f7f7; vertical-align: top; font-weight: bold;"
            },
            {
              "label": "Time",
              "id": "monitoring_time",
              "style": "border: 1px solid #ddd; background: #f7f7f7; vertical-align: top; font-weight: bold;"
            }
          ],
          "static_values": {
            "monitor_kibana": "Monitor apps in kibana\nhttps://kibana-eaas-jpe2c.rakuten-it.com/ecld-scg/app/kibana#/discover/9516dd20-d87c-11eb-91e3-d3d34715d24d\nlog group: eaas_jpe2c-ecld-scg_ecld-scg_scp_java_app_logs-*\nS-IN\nClick here to expand...\nGrafana: https://monitor.rakuten-it.com/v2/d/GSOruU87z/scp-publishers?orgId=1",
            "monitoring_pic": "@Ali, Abrar",
            "monitoring_time": "For 1 hour after release"
          },
          "rows": [
            {
              "label": "Monitor apps in kibana",
              "id": "monitor_kibana"
            }
          ]
        }
      ]
    },
    {
      "heading": "Post Release Checklist",
      "content": [
        {
          "type": "table",
          "style": "border-collapse: collapse; width: 100%; background: #fff; border: 1px solid #ddd; font-size: 15px;",
          "fields": [
            {
              "label": "Task",
              "id": "post_release_task",
              "style": "border: 1px solid #ddd; background: #f7f7f7; vertical-align: top; font-weight: bold;"
            },
            {
              "label": "Status",
              "id": "post_release_status",
              "style": "border: 1px solid #ddd; background: #f7f7f7; vertical-align: top; font-weight: bold;"
            },
            {
              "label": "Remarks",
              "id": "post_release_remarks",
              "style": "border: 1px solid #ddd; background: #f7f7f7; vertical-align: top; font-weight: bold;"
            }
          ],
          "rows": [
            {
              "label": "Request merging of release branch to Master and Develop",
              "id": "request_branch_merge",
              "checkboxes": [
                "DONE",
                "NOT YET",
                "NOT APPLICABLE"
              ]
            }
          ]
        }
      ]
    }
  ]
}